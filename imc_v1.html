<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMC ÌÜµÌï© ÏÑ±Í≥º ÎåÄÏãúÎ≥¥Îìú (v15 Final - Strict Data)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        body { font-family: 'Pretendard', 'Inter', sans-serif; }
        
        /* Scrollbars */
        .custom-scroll { overflow: auto; }
        .custom-scroll::-webkit-scrollbar { height: 10px; width: 10px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f8fafc; border: 1px solid #e2e8f0; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 5px; border: 2px solid #f8fafc; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .timeline-bar { transition: all 0.2s; }
        .timeline-bar:hover { transform: scale(1.02); z-index: 60; box-shadow: 0 4px 12px rgba(0,0,0,0.15); opacity: 1 !important; filter: none; }
        
        /* Sticky Layout */
        .sticky-col-header { position: sticky; top: 0; z-index: 50; }
        .sticky-left-col { position: sticky; left: 0; z-index: 40; background: white; border-right: 1px solid #e2e8f0; }
        
        /* Filter Chip */
        .filter-chip { transition: all 0.2s; cursor: pointer; user-select: none; }
        .filter-chip:hover { transform: translateY(-1px); }
        .filter-chip.active { box-shadow: 0 2px 4px rgba(79, 70, 229, 0.2); }

        /* Table */
        .kpi-table th, .kpi-table td { white-space: nowrap; padding: 10px 16px; }
        .kpi-table th { background-color: #f8fafc; color: #64748b; font-weight: 700; font-size: 11px; text-transform: uppercase; border-bottom: 1px solid #e2e8f0; }
        .kpi-table td { border-bottom: 1px solid #f1f5f9; font-size: 12px; font-weight: 500; color: #334155; }
        .kpi-table .total-col { background-color: #f1f5f9; font-weight: 800; color: #1e293b; border-left: 2px solid #e2e8f0; }
        
        /* Today Highlight Animation */
        .today-pulse { animation: pulse-border 2s infinite; }
        @keyframes pulse-border {
            0% { box-shadow: inset 0 0 0 1px rgba(239, 68, 68, 0.2); }
            50% { box-shadow: inset 0 0 0 2px rgba(239, 68, 68, 0.6); }
            100% { box-shadow: inset 0 0 0 1px rgba(239, 68, 68, 0.2); }
        }
    </style>
</head>
<body class="bg-[#F8F9FC] text-slate-800 h-screen flex flex-col overflow-hidden">

    <nav class="bg-white border-b border-slate-200 h-14 flex-none flex items-center justify-between px-6 z-50 shadow-sm">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-slate-900 rounded-lg flex items-center justify-center text-white font-black text-lg">D</div>
                <h1 class="text-lg font-bold text-slate-800 tracking-tight">IMC ÌÜµÌï© ÏÑ±Í≥º ÎåÄÏãúÎ≥¥Îìú <span class="text-xs font-normal text-slate-400 ml-1">Report View</span></h1>
            </div>
            <div class="h-6 border-l border-slate-300 mx-2"></div>
            <div class="flex items-center gap-3">
                <select id="brandFilter" onchange="applyFilter()" class="bg-slate-900 text-white border border-slate-900 text-sm font-bold rounded pl-3 pr-8 py-1.5 focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer hover:bg-slate-800 shadow-sm">
                    <option value="V">ÎìÄÎ≤†Ìã∞Ïπ¥ (DUVETICA)</option>
                    <option value="ST">ÏÑ∏Î•¥ÏßÄÏò§ ÌÉÄÌÇ§Îãà (ST)</option>
                </select>

                <select id="yearFilter" onchange="applyFilter()" class="bg-indigo-50 border border-indigo-200 text-indigo-700 text-sm font-bold rounded pl-3 pr-8 py-1.5 focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer hover:bg-indigo-100">
                    <option value="ALL">Ï†ÑÏ≤¥ (26ÎÖÑ / 25ÎÖÑ ÎπÑÍµê)</option>
                    <option value="2026">2026ÎÖÑ (ÎãπÌï¥)</option>
                    <option value="2025">2025ÎÖÑ (Ï†ÑÎÖÑ)</option>
                </select>
                <select id="monthFilter" onchange="applyFilter()" class="bg-white border border-slate-200 text-slate-700 text-sm font-bold rounded pl-3 pr-8 py-1.5 focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer hover:bg-slate-50">
                    <option value="ALL">1~2Ïõî ÎàÑÏ†Å</option>
                    <option value="1">1Ïõî (January)</option>
                    <option value="2">2Ïõî (February)</option>
                </select>
            </div>
        </div>
        <div class="text-xs font-medium text-slate-500">
            Í∏∞Ï§ÄÏùº: <span class="text-red-600 font-extrabold bg-red-50 px-2 py-0.5 rounded">2026.01.15 (Î™©)</span>
        </div>
    </nav>

    <div class="bg-white border-b border-slate-200 py-3 px-6 flex items-center gap-3 flex-wrap shadow-[0_4px_6px_-1px_rgba(0,0,0,0.02)] z-40">
        <span class="text-[11px] font-bold text-slate-400 uppercase tracking-wider mr-2">CHANNEL FILTER</span>
        <div id="filter-all" onclick="toggleAllChannels()" class="filter-chip px-3 py-1.5 rounded-full text-xs font-bold bg-slate-800 text-white active">ALL</div>
        <div class="h-4 border-l border-slate-300 mx-1"></div>
        <div id="channel-chips" class="flex items-center gap-2 overflow-x-auto custom-scroll pb-1"></div>
    </div>

    <div class="flex-1 flex flex-col overflow-hidden bg-white">
        
        <div class="flex-1 flex flex-col relative min-h-0">
            <div class="flex-1 custom-scroll bg-white relative" id="gantt-container">
                <div class="min-w-[2000px] h-full relative flex flex-col" id="gantt-content-wrapper">
                    
                    <div class="sticky-col-header bg-white border-b border-slate-200 shadow-sm flex shrink-0 flex-col z-50">
                        <div class="flex w-full">
                            <div class="sticky-left-col w-32 min-w-[8rem] bg-slate-50 z-50 border-r border-slate-200 flex flex-col">
                                <div class="flex-1 border-b border-slate-100 flex items-center justify-center">
                                    <span class="text-[10px] font-bold text-slate-400 uppercase">Channel</span>
                                </div>
                            </div>
                            <div class="flex-1 flex flex-col relative">
                                <div class="h-7 flex text-sm font-bold text-slate-600 bg-slate-100/50 border-b border-slate-100" id="month-header"></div>
                                <div class="h-7 flex text-[11px] font-semibold text-slate-600 bg-slate-50 border-b border-slate-100" id="week-header"></div>
                                <div class="h-7 flex text-[11px] text-slate-500 font-medium bg-white border-b border-slate-100" id="day-header"></div>
                                <div class="h-10 flex bg-slate-50/80 border-b border-slate-200" id="market-issue-header"></div>
                            </div>
                        </div>
                    </div>

                    <div class="relative flex-1">
                        <div class="absolute inset-0 flex pointer-events-none z-0 pl-32" id="grid-lines"></div>
                        <div id="chart-content-layer" class="relative z-20 pt-0 pb-10"></div>
                        
                        </div>
                </div>
            </div>
        </div>

        <div class="h-64 bg-white border-t border-slate-200 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] z-30 shrink-0 flex flex-col">
            <div class="px-6 py-3 border-b border-slate-100 flex justify-between items-center bg-slate-50/30 shrink-0">
                <h3 class="font-bold text-sm text-slate-800 flex items-center gap-2">
                    <span class="w-1.5 h-4 bg-indigo-600 rounded-sm"></span>
                    <span id="summary-title">Ï¢ÖÌï© Í≤∞Í≥º ÏöîÏïΩ (Ï±ÑÎÑêÎ≥Ñ KPI Îß§Ìä∏Î¶≠Ïä§)</span>
                </h3>
                <span class="text-[11px] font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded">(Îã®ÏúÑ: Ï≤úÏõê)</span>
            </div>
            
            <div class="flex-1 custom-scroll p-0 relative">
                <div class="min-w-full inline-block align-middle">
                    <table class="kpi-table w-full text-right">
                        <thead id="summary-thead"></thead>
                        <tbody id="summary-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden animate-in fade-in zoom-in duration-200">
            <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <div class="flex items-center gap-3">
                    <span id="m-year-badge" class="px-2 py-1 bg-slate-600 text-white text-[10px] font-bold uppercase rounded">YEAR</span>
                    <span id="m-brand-badge" class="px-2 py-1 bg-black text-white text-[10px] font-bold uppercase rounded">BRAND</span>
                    <h3 id="m-title" class="text-lg font-bold text-slate-800">Title</h3>
                </div>
                <button onclick="document.getElementById('modal').classList.add('hidden')" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                        <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">ÏÉÅÏÑ∏ ÌòúÌÉù</p>
                        <p id="m-benefit" class="font-medium text-slate-700 text-sm"></p>
                    </div>
                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                        <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">MD ÏΩîÎ©òÌä∏</p>
                        <p id="m-comment" class="font-medium text-slate-600 text-sm italic"></p>
                    </div>
                </div>
                <div class="h-40 border border-slate-100 rounded-xl p-4 bg-white relative">
                    <p class="text-[10px] font-bold text-slate-400 uppercase absolute top-4 left-4">Í∏∞Í∞ÑÎ≥Ñ Îß§Ï∂ú Ï∂îÏù¥</p>
                    <canvas id="chart-canvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const TODAY_M = 1; const TODAY_D = 15;
        const marketIssues = { '1-1': 'Ïã†Ï†ï', '1-29': 'ÏÑ§ÎÇ†', '2-14': 'Î∞úÎ†åÌÉÄÏù∏Îç∞Ïù¥' };
        
        const channelConfig = {
            'ÏûêÏÇ¨Î™∞': { class: 'bg-orange-500 text-white', border: 'border-orange-500' },
            'SSFÏÉµ': { class: 'bg-sky-400 text-white', border: 'border-sky-400' },
            'Î¨¥Ïã†ÏÇ¨': { class: 'bg-black text-white', border: 'border-black' },
            'SSGÎã∑Ïª¥': { class: 'bg-[#FFEB00] text-[#4A3C31] border-2 border-[#4A3C31]', border: 'border-[#4A3C31]' }, 
            'SIÎπåÎ¶¨ÏßÄ': { class: 'bg-[#5D4037] text-white', border: 'border-[#5D4037]' },
            'ÎÑ§Ïù¥Î≤ÑÏä§ÌÜ†Ïñ¥': { class: 'bg-green-500 text-white', border: 'border-green-500' },
            'ÎçîÏπ¥Ìä∏Í≥®ÌîÑ': { class: 'bg-violet-500 text-white', border: 'border-violet-500' },
            'Î°ØÎç∞ON': { class: 'bg-red-500 text-white', border: 'border-red-500' },
            '29CM': { class: 'bg-[#000080] text-white', border: 'border-[#000080]' },
            'EQL': { class: 'bg-lime-400 text-lime-900', border: 'border-lime-400' },
            'Í∏∞ÌÉÄ Ï†úÌú¥Î™∞': { class: 'bg-[#A89F91] text-white', border: 'border-[#A89F91]' }
        };
        const channels = Object.keys(channelConfig);
        const brandMap = { 'V': 'ÎìÄÎ≤†Ìã∞Ïπ¥', 'ST': 'ÏÑ∏Î•¥ÏßÄÏò§ ÌÉÄÌÇ§Îãà' };

        let activeChannels = new Set(channels);

        // --- DATA ---
        let csvData = [];
        // [ÏàòÏ†ï: Î™©ÌëúÎß§Ï∂úÏù¥ ÏóÜÎäî Í∏∞ÌöçÏ†ÑÏùÄ goal=0 Ï≤òÎ¶¨]
        function createPromo(id, brand, ch, name, year, month, startDay, duration, benefit, type, benefitType, showGoal) {
            let sDate = new Date(year, month - 1, startDay);
            let eDate = new Date(sDate);
            eDate.setDate(sDate.getDate() + duration - 1);
            const fmt = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
            
            // Random goal between 20,000 ~ 50,000 (Unit: 1000 KRW)
            const goalAmount = Math.floor(Math.random() * 30000) + 20000;
            const finalGoal = showGoal ? goalAmount : 0;
            
            // Actual Logic
            let actual = 0;
            if (year === 2025) actual = Math.floor((showGoal ? goalAmount : 30000) * (Math.random() * 0.3 + 0.8));
            else {
                const todayObj = new Date(2026, 0, 15);
                if (eDate < todayObj) actual = Math.floor((showGoal ? goalAmount : 30000) * (Math.random() * 0.3 + 0.9));
                else if (sDate > todayObj) actual = 0;
                else actual = Math.floor((showGoal ? goalAmount : 30000) * 0.4);
            }

            return { 
                id, brand, channel: ch, name, start: fmt(sDate), end: fmt(eDate), 
                goal: finalGoal, actual, benefit, 
                comment: year === 2025 ? "Ï†ÑÎÖÑÎèÑ ÎèôÍ∏∞ ÌñâÏÇ¨" : "Í∏àÎÖÑÎèÑ Ï£ºÎ†• ÌñâÏÇ¨",
                type: type || 'ÏûêÏ≤¥',
                benefitType: benefitType || 'Ïø†Ìè∞'
            };
        }

        function generateCleanData() {
            let id = 1;
            // 2026 (ÏõîÎ≥Ñ 3Í∞ú ÎÇ¥Ïô∏Îßå goal: true)
            // Benefits: Ïø†Ìè∞, Ïø†Ìè∞+Ïπ¥ÎìúÌï†Ïù∏, Ïø†Ìè∞+ÏÇ¨ÏùÄÌíà+Î¶¨ÏõåÎìú only.
            const p26 = [
                { b:'V', c:'ÏûêÏÇ¨Î™∞', n:'[1Ïõî] Ïã†ÎÖÑ Ìï¥Ìîº ÏúÑÌÅ¨', m:1, d:2, len:7, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞', g:true },
                { b:'V', c:'Î¨¥Ïã†ÏÇ¨', n:'ÏïÑÏö∞ÌÑ∞ ÌÅ¥Î¶¨Ïñ¥Îü∞Ïä§', m:1, d:5, len:10, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞+Ïπ¥ÎìúÌï†Ïù∏', g:true },
                { b:'V', c:'SSFÏÉµ', n:'Ï£ºÎßê Í≤åÎ¶¥Îùº ÌäπÍ∞Ä', m:1, d:10, len:2, t:'Ï†ÑÏÇ¨', bt:'Ïø†Ìè∞', g:false },
                { b:'V', c:'ÎÑ§Ïù¥Î≤ÑÏä§ÌÜ†Ïñ¥', n:'[Live] Ïã†ÏÉÅ ÏáºÏºÄÏù¥Ïä§', m:1, d:15, len:1, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞+ÏÇ¨ÏùÄÌíà+Î¶¨ÏõåÎìú', g:true },
                { b:'ST', c:'ÏûêÏÇ¨Î™∞', n:'ÌÖåÎãàÏä§ Í∏∞Ïñ¥ Îü∞Ïπ≠', m:1, d:15, len:7, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞', g:false },
                { b:'ST', c:'WÏª®ÏÖâ', n:'ÏñºÎ¶¨Î≤ÑÎìú Ïò§Ìîà', m:1, d:10, len:5, t:'Ï†ÑÏÇ¨', bt:'Ïø†Ìè∞', g:false },
                { b:'V', c:'ÏûêÏÇ¨Î™∞', n:'ÏÑ§ ÏÑ†Î¨ºÏÑ∏Ìä∏ Ï†úÏïà', m:1, d:20, len:10, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞+Ïπ¥ÎìúÌï†Ïù∏', g:false },
                { b:'V', c:'SSGÎã∑Ïª¥', n:'ÏÑ§ Î™ÖÏ†à Ïì±Î∞∞ÏÜ° ÌäπÍ∞Ä', m:1, d:22, len:5, t:'Ï†ÑÏÇ¨', bt:'Ïø†Ìè∞+ÏÇ¨ÏùÄÌíà+Î¶¨ÏõåÎìú', g:false },
                { b:'V', c:'ÏûêÏÇ¨Î™∞', n:'[2Ïõî] ÎùºÏä§Ìä∏ ÏúàÌÑ∞', m:2, d:1, len:7, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞', g:true },
                { b:'V', c:'Î¨¥Ïã†ÏÇ¨', n:'Î∞úÎ†åÌÉÄÏù∏ Ïª§ÌîåÎ£©', m:2, d:8, len:7, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞', g:false },
                { b:'ST', c:'ÎçîÏπ¥Ìä∏Í≥®ÌîÑ', n:'Í≥®ÌîÑ ÏãúÏ¶å Ïò§ÌîÑÎãù', m:2, d:20, len:5, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞+Ïπ¥ÎìúÌï†Ïù∏', g:true },
                { b:'ST', c:'29CM', n:'26SS ÏáºÏºÄÏù¥Ïä§', m:2, d:15, len:14, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞', g:true },
                { b:'V', c:'SSFÏÉµ', n:'Ï£ºÎßê ÌïúÏ†ï Ïø†Ìè∞', m:2, d:21, len:2, t:'Ï†ÑÏÇ¨', bt:'Ïø†Ìè∞', g:false },
                { b:'V', c:'Î°ØÎç∞ON', n:'ÌçºÏä§Ìä∏ Î®ºÎç∞Ïù¥', m:1, d:6, len:1, t:'Ï†ÑÏÇ¨', bt:'Ïø†Ìè∞+Ïπ¥ÎìúÌï†Ïù∏', g:false },
                { b:'ST', c:'SIÎπåÎ¶¨ÏßÄ', n:'Îü≠ÏÖîÎ¶¨ ÎåÄÏ†Ñ', m:1, d:18, len:5, t:'Ï†ÑÏÇ¨', bt:'Ïø†Ìè∞', g:false },
                { b:'V', c:'EQL', n:'ÏùµÏä§ÌÅ¥Î£®ÏãúÎ∏å ÎìúÎ°≠', m:2, d:5, len:3, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞', g:false }
            ];
            p26.forEach(p => {
                let ch = p.c === 'WÏª®ÏÖâ' ? 'Í∏∞ÌÉÄ Ï†úÌú¥Î™∞' : p.c;
                if(!channelConfig[ch]) ch = 'Í∏∞ÌÉÄ Ï†úÌú¥Î™∞';
                csvData.push(createPromo(id++, p.b, ch, p.n, 2026, p.m, p.d, p.len, "10% Ìï†Ïù∏", p.t, p.bt, p.g));
            });

            // 2025
            const p25 = [
                { b:'V', c:'ÏûêÏÇ¨Î™∞', n:'[25ÎÖÑ] Ïã†ÎÖÑ Í∞êÏÇ¨Ï†ú', m:1, d:3, len:5, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞' },
                { b:'V', c:'Î¨¥Ïã†ÏÇ¨', n:'[25ÎÖÑ] ÏïÑÏö∞ÌÑ∞ ÎåÄÏ†Ñ', m:1, d:6, len:8, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞' },
                { b:'V', c:'SSFÏÉµ', n:'[25ÎÖÑ] Ï£ºÎßê ÌäπÍ∞Ä', m:1, d:11, len:2, t:'Ï†ÑÏÇ¨', bt:'Ïø†Ìè∞' },
                { b:'V', c:'ÎÑ§Ïù¥Î≤ÑÏä§ÌÜ†Ïñ¥', n:'[25ÎÖÑ] ÎùºÏù¥Î∏å ÌäπÍ∞Ä', m:1, d:20, len:1, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞+ÏÇ¨ÏùÄÌíà+Î¶¨ÏõåÎìú' },
                { b:'ST', c:'ÏûêÏÇ¨Î™∞', n:'[25ÎÖÑ] ÏãúÏ¶å Ïò§ÌîÑ', m:1, d:15, len:10, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞' },
                { b:'V', c:'ÏûêÏÇ¨Î™∞', n:'[25ÎÖÑ] ÏÑ§ ÏñºÎ¶¨Î≤ÑÎìú', m:1, d:15, len:12, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞' },
                { b:'ST', c:'ÎçîÏπ¥Ìä∏Í≥®ÌîÑ', n:'[25ÎÖÑ] Îß§ÎãàÏïÑ ÏúÑÌÅ¨', m:2, d:5, len:7, t:'Ï†ÑÏÇ¨', bt:'Ïø†Ìè∞' },
                { b:'V', c:'Î¨¥Ïã†ÏÇ¨', n:'[25ÎÖÑ] Î∞úÎ†åÌÉÄÏù∏', m:2, d:10, len:5, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞' },
                { b:'ST', c:'29CM', n:'[25ÎÖÑ] SS Î£©Î∂Å Ïò§Ìîà', m:2, d:18, len:10, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞' },
                { b:'V', c:'SSGÎã∑Ïª¥', n:'[25ÎÖÑ] Î™ÖÏ†à ÏÑ†Î¨º', m:1, d:21, len:5, t:'Ï†ÑÏÇ¨', bt:'Ïø†Ìè∞+Ïπ¥ÎìúÌï†Ïù∏' },
                { b:'V', c:'Î°ØÎç∞ON', n:'[25ÎÖÑ] Î∏åÎûúÎìú Îç∞Ïù¥', m:1, d:7, len:1, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞' },
                { b:'ST', c:'SIÎπåÎ¶¨ÏßÄ', n:'[25ÎÖÑ] ÌÖåÎãàÏä§', m:1, d:25, len:5, t:'Ï†ÑÏÇ¨', bt:'Ïø†Ìè∞' },
                { b:'V', c:'EQL', n:'[25ÎÖÑ] Îã®ÎèÖ Í∏∞Ìöç', m:2, d:3, len:5, t:'ÏûêÏ≤¥', bt:'Ïø†Ìè∞' }
            ];
            p25.forEach(p => {
                 let ch = p.c === 'WÏª®ÏÖâ' ? 'Í∏∞ÌÉÄ Ï†úÌú¥Î™∞' : p.c;
                 if(!channelConfig[ch]) ch = 'Í∏∞ÌÉÄ Ï†úÌú¥Î™∞';
                 // 2025 data mostly no goals for simplicity in simulation, or random
                 csvData.push(createPromo(id++, p.b, ch, p.n, 2025, p.m, p.d, p.len, "Ï†ÅÎ¶ΩÍ∏à 5%", p.t, p.bt, (id%3===0))); 
            });
        }
        generateCleanData();

        // --- UI LOGIC ---
        function init() {
            renderHeaderAndGrid();
            renderChannelChips();
            applyFilter();
        }

        function renderChannelChips() {
            const container = document.getElementById('channel-chips');
            container.innerHTML = '';
            channels.forEach(ch => {
                const isActive = activeChannels.has(ch);
                const chip = document.createElement('div');
                const conf = channelConfig[ch];
                let css = isActive 
                    ? `bg-white text-slate-800 border ${conf.border} shadow-sm font-bold ring-1 ring-inset ${conf.border.replace('border','ring')}` 
                    : `bg-slate-100 text-slate-400 border border-slate-200`;
                chip.className = `filter-chip px-3 py-1.5 rounded-full text-xs whitespace-nowrap ${css}`;
                chip.innerText = ch;
                chip.onclick = () => toggleChannel(ch);
                container.appendChild(chip);
            });
            const allBtn = document.getElementById('filter-all');
            const isAll = channels.length === activeChannels.size;
            allBtn.className = `filter-chip px-3 py-1.5 rounded-full text-xs font-bold ${isAll ? 'bg-slate-800 text-white' : 'bg-slate-100 text-slate-400'}`;
        }

        function toggleChannel(ch) {
            if(activeChannels.has(ch)) activeChannels.delete(ch);
            else activeChannels.add(ch);
            renderChannelChips();
            applyFilter();
        }

        function toggleAllChannels() {
            if(activeChannels.size === channels.length) activeChannels.clear();
            else channels.forEach(c => activeChannels.add(c));
            renderChannelChips();
            applyFilter();
        }

        // --- GANTT RENDER ---
        const totalDays = 59; 

        function applyFilter() {
            const sBrand = document.getElementById('brandFilter').value;
            const sYear = document.getElementById('yearFilter').value;
            const sMonth = document.getElementById('monthFilter').value;
            
            const filtered = csvData.filter(d => {
                const y = parseInt(d.start.substring(0,4));
                const m = parseInt(d.start.substring(5,7));
                const bm = d.brand === sBrand;
                const mm = sMonth === 'ALL' || m == sMonth;
                let ym = true;
                if(sYear !== 'ALL') ym = (y == sYear);
                return bm && mm && ym; 
            });

            const summaryData = filtered.filter(d => activeChannels.has(d.channel));
            renderGanttRows(filtered, sYear);
            renderSummaryTable(summaryData);
        }

        function renderGanttRows(data, selectedYear) {
            const container = document.getElementById('chart-content-layer');
            container.innerHTML = '';

            const drawSection = (yearData, year) => {
                const yearLabelRow = document.createElement('div');
                yearLabelRow.className = "flex w-full h-8 border-b border-indigo-100 bg-indigo-50/30 items-center shrink-0";
                const stickyLabel = document.createElement('div');
                stickyLabel.className = "sticky-left-col w-32 min-w-[8rem] h-full flex items-center justify-center bg-indigo-50 font-bold text-indigo-900 text-xs gap-2 z-40";
                stickyLabel.innerHTML = `<span class="bg-indigo-600 text-white px-2 py-0.5 rounded text-[10px]">${year}</span>`;
                yearLabelRow.appendChild(stickyLabel);
                container.appendChild(yearLabelRow);

                const group = {};
                channels.forEach(ch => group[ch] = []);
                yearData.forEach(d => { if(group[d.channel]) group[d.channel].push(d); });

                channels.forEach(ch => {
                    if(!activeChannels.has(ch)) return; 
                    const items = group[ch];
                    const row = document.createElement('div');
                    row.className = "flex w-full h-9 border-b border-slate-100 bg-white items-center group shrink-0";

                    const stickyCol = document.createElement('div');
                    stickyCol.className = "sticky-left-col w-32 min-w-[8rem] h-full flex items-center px-3 bg-white z-40 shadow-[2px_0_5px_rgba(0,0,0,0.02)]";
                    const conf = channelConfig[ch];
                    const bgClass = conf.class.split(' ')[0];
                    stickyCol.innerHTML = `
                        <div class="flex items-center gap-2 w-full cursor-pointer" onclick="toggleChannel('${ch}')">
                            <span class="w-2.5 h-2.5 rounded-sm ${bgClass} opacity-80"></span>
                            <span class="text-[11px] text-slate-600 font-medium truncate select-none">${ch}</span>
                        </div>
                    `;
                    row.appendChild(stickyCol);

                    const barsArea = document.createElement('div');
                    barsArea.className = "flex-1 h-full relative";

                    if(items.length > 0) {
                        items.forEach(item => {
                            const s = getDateIndex(item.start);
                            const e = getDateIndex(item.end);
                            if(s > totalDays || e < 1) return;
                            
                            const start = Math.max(1, s);
                            const end = Math.min(totalDays, e);
                            const width = (end - start + 1) * (100/totalDays);
                            const left = (start - 1) * (100/totalDays);
                            
                            let baseClass = channelConfig[ch].class;
                            let opacityStyle = "";
                            let isPast = (year === 2025);
                            const todayObj = new Date(2026, 0, 15);
                            if(!isPast) {
                                const endObj = new Date(item.end);
                                if(endObj < todayObj) isPast = true;
                            }
                            if(isPast) opacityStyle = "opacity: 0.5; filter: grayscale(20%);"; 
                            
                            // [ÏàòÏ†ï: ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÎÖ∏Ï∂ú]
                            // Format: Name | Type | Benefit | Goal(if >0)
                            const details = [];
                            if(item.type) details.push(item.type);
                            if(item.benefitType) details.push(item.benefitType);
                            // [ÏàòÏ†ï: Goal formatting 20K -> 20,000]
                            if(item.goal > 0) details.push(`üéØ${item.goal.toLocaleString()}`);
                            
                            let detailHtml = "";
                            if(details.length > 0) {
                                detailHtml = `<span class="ml-1 opacity-70 text-[9px] font-normal tracking-tight">| ${details.join(' | ')}</span>`;
                            }
                            const fullTooltip = `${item.name} | ${details.join(' | ')}`;

                            const bar = document.createElement('div');
                            bar.className = `absolute top-1.5 h-6 rounded-sm shadow-sm text-[11px] font-bold flex items-center px-2 cursor-pointer timeline-bar overflow-hidden ${baseClass}`;
                            // ÎßêÏ§ÑÏûÑ Ï≤òÎ¶¨ (text-overflow)
                            bar.setAttribute('style', `left: ${left}%; width: calc(${width}% - 1px); ${opacityStyle}; white-space: nowrap; text-overflow: ellipsis;`);
                            bar.setAttribute('title', fullTooltip); 
                            bar.innerHTML = `<span>${item.name}</span>${detailHtml}`;
                            bar.onclick = () => openModal(item);
                            barsArea.appendChild(bar);
                        });
                    }
                    row.appendChild(barsArea);
                    container.appendChild(row);
                });
            };

            const d26 = data.filter(d => d.start.startsWith('2026'));
            const d25 = data.filter(d => d.start.startsWith('2025'));

            if(selectedYear === 'ALL' || selectedYear === '2026') drawSection(d26, 2026);
            if(selectedYear === 'ALL') {
                 const div = document.createElement('div');
                 div.className = "h-4 bg-slate-50 border-y border-slate-100 shrink-0";
                 container.appendChild(div);
            }
            if(selectedYear === 'ALL' || selectedYear === '2025') drawSection(d25, 2025);
        }

        // --- SUMMARY MATRIX ---
        function renderSummaryTable(data) {
            const thead = document.getElementById('summary-thead');
            const tbody = document.getElementById('summary-tbody');
            thead.innerHTML = ''; tbody.innerHTML = '';

            const activeList = channels.filter(c => activeChannels.has(c));
            
            let headerHTML = '<tr><th class="sticky left-0 bg-slate-50 z-20 w-32 min-w-[8rem] border-r border-slate-200">Íµ¨Î∂Ñ (KPI)</th>';
            activeList.forEach(ch => { headerHTML += `<th>${ch}</th>`; });
            headerHTML += '<th class="total-col sticky right-0">Total</th></tr>';
            thead.innerHTML = headerHTML;

            const d26 = data.filter(d => d.start.startsWith('2026'));
            const d25 = data.filter(d => d.start.startsWith('2025'));

            const sums26 = {}; const sums25 = {};
            activeList.forEach(ch => { sums26[ch] = { goal: 0, rev: 0 }; sums25[ch] = { goal: 0, rev: 0 }; });

            d26.forEach(d => { if(sums26[d.channel]) { sums26[d.channel].goal += d.goal; sums26[d.channel].rev += d.actual; } });
            d25.forEach(d => { if(sums25[d.channel]) { sums25[d.channel].goal += d.goal; sums25[d.channel].rev += d.actual; } });

            const fmt = n => n.toLocaleString();
            
            // Goal
            let trGoal = '<tr><td class="font-bold text-slate-600 sticky left-0 bg-white z-10 border-r border-slate-100">Î™©Ìëú (Goal)</td>';
            let totalGoal = 0;
            activeList.forEach(ch => { const val = sums26[ch].goal; totalGoal += val; trGoal += `<td>${fmt(val)}</td>`; });
            trGoal += `<td class="total-col sticky right-0">${fmt(totalGoal)}</td></tr>`;

            // Revenue
            let trRev = '<tr><td class="font-bold text-slate-600 sticky left-0 bg-white z-10 border-r border-slate-100">Ïã§Ï†Å (Revenue)</td>';
            let totalRev = 0;
            activeList.forEach(ch => { const val = sums26[ch].rev; totalRev += val; trRev += `<td class="font-bold text-indigo-600 bg-indigo-50/10">${fmt(val)}</td>`; });
            trRev += `<td class="total-col sticky right-0 text-indigo-800">${fmt(totalRev)}</td></tr>`;

            // Rate
            let trRate = '<tr><td class="font-bold text-slate-600 sticky left-0 bg-white z-10 border-r border-slate-100">Îã¨ÏÑ±Î•† (Rate)</td>';
            activeList.forEach(ch => {
                const g = sums26[ch].goal; const r = sums26[ch].rev;
                const rate = g > 0 ? (r/g*100).toFixed(1) : 0;
                let colorClass = rate >= 100 ? 'text-green-600 font-bold' : (rate >= 80 ? 'text-slate-600' : 'text-red-500');
                trRate += `<td class="${colorClass}">${rate}%</td>`;
            });
            const totalRate = totalGoal > 0 ? (totalRev/totalGoal*100).toFixed(1) : 0;
            trRate += `<td class="total-col sticky right-0">${totalRate}%</td></tr>`;

            // [ÏàòÏ†ï: YoY Color Logic - Red for Growth, Blue for Decline]
            let trYoY = '<tr><td class="font-bold text-slate-600 sticky left-0 bg-white z-10 border-r border-slate-100">Ï†ÑÎÖÑÎπÑ (YoY)</td>';
            let totalRev25 = 0;
            activeList.forEach(ch => {
                const cur = sums26[ch].rev; const prev = sums25[ch].rev;
                totalRev25 += prev;
                if(prev === 0) trYoY += `<td class="text-slate-300">-</td>`;
                else {
                    const growth = ((cur - prev)/prev*100).toFixed(1);
                    const isPos = growth >= 0;
                    // Red for Growth, Blue for Decline
                    const colorClass = isPos ? 'text-red-600' : 'text-blue-600';
                    trYoY += `<td class="${colorClass} font-bold text-[11px]">${isPos?'‚ñ≤':'‚ñº'} ${Math.abs(growth)}%</td>`;
                }
            });
            let totalGrowthHtml = '-';
            if(totalRev25 > 0) {
                 const g = ((totalRev - totalRev25)/totalRev25*100).toFixed(1);
                 const p = g >= 0;
                 const tc = p ? 'text-red-600' : 'text-blue-600';
                 totalGrowthHtml = `<span class="${tc}">${p?'‚ñ≤':'‚ñº'} ${Math.abs(g)}%</span>`;
            }
            trYoY += `<td class="total-col sticky right-0">${totalGrowthHtml}</td></tr>`;

            tbody.innerHTML = trGoal + trRev + trRate + trYoY;
        }

        // Header Grid
        function renderHeaderAndGrid() {
            const mHead = document.getElementById('month-header');
            const wHead = document.getElementById('week-header');
            const dHead = document.getElementById('day-header');
            const miHead = document.getElementById('market-issue-header');
            const gl = document.getElementById('grid-lines');
            
            mHead.innerHTML = ''; wHead.innerHTML = ''; dHead.innerHTML = ''; miHead.innerHTML = ''; gl.innerHTML = '';

            const months = [ { name: '1Ïõî', days: 31 }, { name: '2Ïõî', days: 28 } ];
            let globalDayIndex = 0; 

            months.forEach((m, mIdx) => {
                const mDiv = document.createElement('div');
                mDiv.className = "flex items-center justify-center border-r border-slate-200 h-full relative";
                mDiv.style.width = `${(m.days / totalDays) * 100}%`;
                mDiv.innerHTML = `<span class="sticky left-0">${m.name}</span>`;
                mHead.appendChild(mDiv);

                for(let i=1; i<=m.days; i++) {
                    globalDayIndex++;
                    const key = `${mIdx+1}-${i}`;
                    const isToday = (mIdx + 1 === TODAY_M && i === TODAY_D);
                    // [ÏàòÏ†ï: Highlight only on Header cells]
                    const highlightClass = isToday ? "bg-red-50 text-red-600 font-extrabold today-pulse border-red-200 border-x" : "";
                    
                    const dDiv = document.createElement('div');
                    dDiv.className = `flex-1 border-r border-slate-100 flex items-center justify-center h-full text-[11px] ${highlightClass}`;
                    dDiv.innerText = i;
                    if(!isToday && (globalDayIndex % 7 === 3 || globalDayIndex % 7 === 4)) dDiv.classList.add('text-red-400', 'bg-red-50/20');
                    dHead.appendChild(dDiv);

                    const miDiv = document.createElement('div');
                    miDiv.className = `flex-1 border-r border-slate-200 flex items-center justify-center h-full overflow-hidden px-0.5 ${isToday ? "bg-red-50 border-x border-red-200" : ""}`;
                    if(marketIssues[key]) miDiv.innerHTML = `<span class="text-indigo-700 font-bold text-[10px] w-full text-center leading-3 break-all whitespace-normal">${marketIssues[key]}</span>`;
                    miHead.appendChild(miDiv);

                    const lDiv = document.createElement('div');
                    lDiv.className = "flex-1 border-r border-slate-100 h-full " + ((globalDayIndex % 7 === 3 || globalDayIndex % 7 === 4) ? 'bg-slate-50/50' : '');
                    gl.appendChild(lDiv);
                }
            });

            const weeks = [
                { name: '1Ï£º', days: 4 }, { name: '2Ï£º', days: 7 }, { name: '3Ï£º', days: 7 }, 
                { name: '4Ï£º', days: 7 }, { name: '5Ï£º', days: 6, class: 'border-r-0' }, 
                { name: '5Ï£º', days: 1, class: 'border-l-0 text-transparent' }, 
                { name: '6Ï£º', days: 7 }, { name: '7Ï£º', days: 7 }, { name: '8Ï£º', days: 7 }, { name: '9Ï£º', days: 6 }, 
            ];
            weeks.forEach(w => {
                const wDiv = document.createElement('div');
                wDiv.className = `flex items-center justify-center border-r border-slate-300 h-full text-[11px] bg-white ${w.class || ''}`;
                wDiv.style.width = `${(w.days / totalDays) * 100}%`;
                wDiv.innerText = (w.name === '5Ï£º' && w.days === 1) ? '' : w.name;
                wHead.appendChild(wDiv);
            });
        }

        function getDateIndex(dateStr) {
            const m = parseInt(dateStr.substring(5,7));
            const d = parseInt(dateStr.substring(8,10));
            if(m===1) return d;
            if(m===2) return 31+d;
            return -1;
        }

        let chartInstance;
        function openModal(item) {
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('m-title').innerText = item.name;
            document.getElementById('m-year-badge').innerText = item.start.substring(0,4);
            document.getElementById('m-brand-badge').innerText = brandMap[item.brand];
            document.getElementById('m-benefit').innerText = item.benefit || '-';
            document.getElementById('m-comment').innerText = `"${item.comment}"`;
            const ctx = document.getElementById('chart-canvas').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5'],
                    datasets: [{ label: 'Sales', data: [120, 190, 150, 220, 300], backgroundColor: '#4f46e5', borderRadius: 4 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
            });
        }

        init();
    </script>
</body>
</html>